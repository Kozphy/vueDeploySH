
set -e

# https://en.wikipedia.org/wiki/ANSI_escape_code
lgreen='\033[1;32m'
yellow='\033[1;33m'
norm='\033[0m'
bold='\033[1m'

echo
echo "=============================================================="
echo "${lgreen} 一鍵部署 5 秒後開始運作  ${norm}"
echo "=============================================================="

sleep 5s

echo
echo "=============================================================="
echo "${yellow} 準備取得 Git 遠端 Url...${norm}"
echo "=============================================================="

originUrl=$(git config --get remote.origin.url)

echo
echo "=============================================================="
echo "${lgreen} 目前遠端分支: ${originUrl} ${norm}"
echo "=============================================================="

split=${originUrl:0:5}
status='';
if [ $split = 'https' ]
then
  status='HTTPS'
else
  status='SSH'
fi

echo
echo "=============================================================="
echo "${lgreen} 傳輸方式將採用 $status ${norm}"
echo "${lgreen} 目前遠端分支 URL：$originUrl ${norm}"
echo "=============================================================="

echo
echo "=============================================================="
echo "${yellow} 開始編譯 Vue Cli ${norm}"
echo "=============================================================="

npm run build

echo
echo "=============================================================="
echo "${lgreen} 編譯完成 ${norm}"
echo "=============================================================="

echo
echo "=============================================================="
echo "${yellow} 移動到編譯完成的資料夾 ${norm}"
echo "=============================================================="

cd dist

echo
echo "=============================================================="
echo "${yellow} 初始化 Git 與加入 Commit ${norm}"
echo "=============================================================="

git init
git add .
git commit -m "update `date +'%Y-%m-%d %H:%M:%S'`";

echo
echo "=============================================================="
echo "${yellow} 部署檔案到遠端分支 ${norm}"
echo "=============================================================="

git push -f $originUrl master:gh-pages

echo
echo "=============================================================="
echo "${yellow} 部署完成 ${norm}"
echo "=============================================================="

echo
echo "=============================================================="
echo "${lgreen} 一鍵部署指令結束 ${norm}"
echo "=============================================================="
